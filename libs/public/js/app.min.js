var $jscomp$this=this;
$(function(){var e;call=function(a,b,c,d){$.ajax({url:a,type:b,data:c,contentType:"application/json",success:function(a){d(a)}})};if(void 0!=$(".graph .sparkline").highcharts){var m={key:opt.key},n=[],g=[],p=[],h=[],q={chart:{type:"areaspline",backgroundColor:null,style:{fontFamily:'"Avenir W01", sans-serif',fontSize:"12px"},margin:[0,0,0,0],spacingLeft:0},title:{text:null},credits:{enabled:!1},xAxis:{title:{enabled:!1},labels:{enabled:!1},tickLength:0,gridLineWidth:0,minorGridLineWidth:0,lineWidth:0,
tickmarkPlacement:"on",minPadding:0,maxPadding:0},yAxis:{title:{enabled:!1},labels:{enabled:!1},gridLineWidth:0,minorGridLineWidth:0,TickLength:0},tooltip:{shared:!0,useHTML:!0,borderWidth:0,borderRadius:4,padding:11,shadow:!1,headerFormat:'<div style="color: {series.color}">{point.x} </div>',pointFormat:"<h6><b>{point.y}</b></h6>",style:{color:"#fff"}},plotOptions:{areaspline:{fillColor:"rgba(255,255,255,.3)",marker:{enabled:!1,radius:1,states:{hover:{enabled:!1}}}}},series:[{color:"#fff"}],legend:{enabled:!1},
noData:{style:{color:"#fff"},useHTML:!0}};opt.hitOptions=JSON.parse(JSON.stringify(q));opt.clickOptions=JSON.parse(JSON.stringify(q));updateDataHits=function(){call("/endpoint/data/hits","GET",m,function(a){if(a){var b="";for(val in a){var b=Object.keys(a[val])[0],c=moment(1E3*Object.keys(a[val])[0]).format("MMMM Do, H:mm");g.push(c);n.push(Object.values(a[val])[0])}opt.hitLast=Object.values(a[a.length-1])[0];a=g.length-1.5;opt.hitOptions.xAxis.min=.5;opt.hitOptions.xAxis.max=a;opt.hitOptions.xAxis.categories=
g;opt.hitOptions.series[0].name="Page hits";opt.hitOptions.series[0].data=n;opt.hitOptions.chart.renderTo="chart_h";opt.hitChart=new Highcharts.Chart(opt.hitOptions);opt.lastTime=b;updateTimes();updateIncreases(!0,!1)}})};updateDataClicks=function(){call("/endpoint/data/clicks","GET",m,function(a){if(a){var b="";for(val in a){var b=Object.keys(a[val])[0],c=moment(1E3*b).format("MMMM Do, H:mm");h.push(c);p.push(Object.values(a[val])[0])}opt.clickLast=Object.values(a[a.length-1])[0];a=h.length-1.5;
opt.clickOptions.xAxis.min=.5;opt.clickOptions.xAxis.max=a;opt.clickOptions.xAxis.categories=h;opt.clickOptions.series[0].name="Clicks";opt.clickOptions.series[0].data=p;opt.clickOptions.chart.renderTo="chart_c";opt.clickChart=new Highcharts.Chart(opt.clickOptions);opt.lastTime=b;updateTimes();updateIncreases(!1,!0)}})};updateTimes=function(){$(".graph_clicks span .updated, .graph_hits span .updated").text("Last updated "+moment(1E3*opt.lastTime).fromNow())};updateCharts=function(a){if(opt.clickChart||
opt.hitChart)epoch=moment(1E3*a.xAxis).format("MMMM Do, H:mm"),opt.clickChart.destroy(),19<opt.clickOptions.series[0].data.length&&(opt.clickOptions.xAxis.categories.shift(),opt.clickOptions.series[0].data.shift()),opt.clickOptions.xAxis.categories.push(epoch),opt.clickLast=a.yClicks,opt.clickOptions.series[0].data.push(a.yClicks),opt.clickOptions.xAxis.max=opt.clickOptions.series[0].data.length-1.5,opt.clickChart=new Highcharts.Chart(opt.clickOptions),opt.hitChart.destroy(),19<opt.clickOptions.series[0].data.length&&
(opt.hitOptions.xAxis.categories.shift(),opt.hitOptions.series[0].data.shift()),opt.hitOptions.xAxis.categories.push(epoch),opt.hitLast=a.yHits,opt.hitOptions.series[0].data.push(a.yHits),opt.hitOptions.xAxis.max=opt.hitOptions.series[0].data.length-1.5,opt.hitChart=new Highcharts.Chart(opt.hitOptions),opt.lastTime=a.xAxis,updateTimes(),updateIncreases(!0,!0)}}"function"==typeof io&&(io(opt.trackR).on("change",function(a){switch(a.type){case "click":updateClickTrackers(a.change);break;case "hit":updateHitTrackers(a.change)}$("#empty").is(":visible")&&
($("#empty").slideUp("fast"),$("#clicks").parent().slideDown("fast",function(){updateDataClicks()}),$("#hits").parent().slideDown("fast",function(){updateDataHits()}))}).on("updated",function(a){updateCharts(a)}).on("connect",function(){$(".signal span").addClass("connected")}).on("disconnect",function(){$(".signal span").removeClass("connected")}),updateIncreases=function(a,b){a&&(opt.hitIncrease=parseInt(100*(opt.hitTotal-opt.hitLast)/opt.hitLast),$(".graph_hits .prc").text(isNaN(opt.hitIncrease)?
"0":opt.hitIncrease));b&&(opt.clickIncrease=parseInt(100*(opt.clickTotal-opt.clickLast)/opt.clickLast),$(".graph_clicks .prc").text(isNaN(opt.clickIncrease)?"0":opt.clickIncrease))},updateClickTrackers=function(a){var b=a[0];a=a[1];$('[data-click="'+b+'"]').length?$('[data-click="'+b+'"]').html(b+" <span>"+a+"</span>"):$("#clicks").append('<li data-click="'+b+'">'+b+" <span>"+a+"</span></li>");opt.clickTotal=parseInt(opt.clickTotal+1);$(".graph_clicks h2").text(opt.clickTotal);updateIncreases(!1,
!0);$('[data-click="'+b+'"]').addClass("flash").delay(1E3).queue(function(){$(this).removeClass("flash").dequeue()})},updateHitTrackers=function(a){var b=a.page[0],c=a.page[1],d=a.countries[0],e=a.countries[1],f=a.devices[0];a=a.devices[1];$('[data-hit="'+b+'"]').length?$('[data-hit="'+b+'"]').html(b+" <span>"+c+"</span>"):$("#hits").append('<li data-hit="'+b+'">'+b+" <span>"+c+"</span></li>");$('[data-country="'+d+'"]').length?$('[data-country="'+d+'"]').html(d+" <span>"+e+"</span>"):$("#countries").append('<li data-country="'+
d+'">'+d+" <span>"+e+"</span></li>");$('[data-device="'+f+'"]').length?$('[data-device="'+f+'"]').html(f+" <span>"+a+"</span>"):$("#devices").append('<li data-device="'+f+'">'+f+" <span>"+a+"</span></li>");opt.hitTotal=parseInt(opt.hitTotal+1);$(".graph_hits h2").text(opt.hitTotal);updateIncreases(!0,!1);$('[data-hit="'+b+'"], [data-country="'+d+'"], [data-device="'+f+'"]').addClass("flash").delay(1E3).queue(function(){$(this).removeClass("flash").dequeue()})});$("input").bind("keydown",function(){$(this).removeClass("error")});
$(".create").bind("click",function(){data={name:$("#appname").val(),domain:$("#domain").val()};$.ajax({url:"/create/key",type:"POST",data:JSON.stringify(data),contentType:"application/json",success:function(a){a.status?($(".error").stop().slideDown("fast").find("p").html('<i class="ion-android-alert"/> '+a.message).parent().delay(8E3).slideUp("fast"),$("#"+a.element).addClass("error").delay(8E3).queue(function(){$(this).removeClass("error").dequeue()})):window.location.href="/key/"+a}})});$(".d_key").bind("click",
function(){data={key:opt.key};call("/endpoint/key/delete","POST",JSON.stringify(data),function(a){a&&(window.location.href="/keys/all")})});$(".search").bind("click",function(){var a=this;$(this).hasClass("open")?$(this).find(".filter").is(":empty")&&($(this).removeClass("open"),$(this).find(".filter").addClass("forcehidden"),$(this).animate({width:e},200)):(e=$(this).css("width"),$(this).animate({width:130},200,function(){$(a).addClass("open");$(a).find(".filter").removeClass("forcehidden").focus()}))});
toggleModal=function(a){$(".confirm").attr("class","confirm");$(".cancel").attr("class","cancel");$(".modal").fadeToggle("fast");a?$(".modal #"+a).is(":visible")?$(".modal #"+a).slideUp("fast"):$(".modal #"+a).slideDown("fast"):$(".modal .box").is(":visible")?$(".modal .box").slideUp("fast"):$(".modal .box").slideDown("fast")};$("[data-modal]").bind("click",function(){var a=$(this).attr("data-modal");toggleModal(a);$(this).attr("data-type");opt.keyName&&($(".confirm").toggleClass("d_key"),$(".box h5").html("Are you sure you want to delete "+
opt.keyName+"?"))});$(".update_avatar").bind("click",function(){var a=$("#avatarUrl").val();call("/endpoint/update/avatar","POST",JSON.stringify({avatar:a}),function(b){1==b?(toggleModal(),$(".profile_image img").attr("src",a)):$("#"+b.element).addClass("error").delay(8E3).queue(function(){$(this).removeClass("error").dequeue()})})});$(".filter").on("input",function(){var a=$(this).text();$(this).closest("ul").find("li").removeClass("last_li");$(this).closest("ul").find("li").each(function(){-1<$(this).text().indexOf(a)?
$(this).stop().slideDown("fast"):$(this).stop().slideUp("fast")})});$(document).keyup(function(a){27===a.keyCode&&$(".modal").is(":visible")&&toggleModal()}).mouseup(function(a){var b=$(".search"),c=$(".search.open");b.is(a.target)||0!==b.has(a.target).length||""!=c.find(".filter").text()||void 0==e||(b.removeClass("open"),b.find(".filter").addClass("forcehidden"),b.animate({width:e},200))});var k,l=0,r=$("header.nav").outerHeight();$(window).scroll(function(){k=!0});setInterval(function(){k&&(hasScrolled(),
k=!1)},250);hasScrolled=function(){var a=$($jscomp$this).scrollTop();0>=a&&$("header.nav").removeClass("fx");5>=Math.abs(l-a)||(a>r&&(a>l?$("header.nav").slideUp("fast",function(){$("header.nav").removeClass("fx").addClass("nav-up")}):a+$(window).height()<$(document).height()&&0<a&&$("header.nav").removeClass("nav-up").addClass("fx").slideDown("fast")),l=a)};initialise=function(){void 0!=$(".graph .sparkline").highcharts&&(updateDataHits(),updateDataClicks(),setInterval(updateTimes,6E4))};initialise()});
